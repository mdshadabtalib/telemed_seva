{% extends 'base.html' %}
{% block page_class %}page-patient{% endblock %}
{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
  <!-- Sidebar -->
  <aside class="lg:col-span-1 card sticky top-6">
    <a href="{{ url_for('profile') }}" class="flex items-center gap-3 mb-4 hover:opacity-80 transition">
      {% if current_user.profile_image %}
        <img src="{{ url_for('uploaded_file', filename=current_user.profile_image) }}" alt="Profile" class="avatar avatar-lg">
      {% else %}
        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-teal-400 to-cyan-500 flex items-center justify-center text-white font-semibold shadow-md">{{ current_user.fullname.split(' ')[0][0] }}</div>
      {% endif %}
      <div>
        <div class="font-semibold">{{ current_user.fullname }}</div>
        <div class="muted">ğŸ‘¤ Patient</div>
      </div>
    </a>
    <nav class="space-y-2">
      <a href="{{ url_for('patient_dashboard') }}" class="block px-3 py-2 rounded-lg bg-indigo-50 text-indigo-700 font-medium">ğŸ“… My Appointments</a>
      <a href="{{ url_for('my_orders') }}" class="block px-3 py-2 rounded-lg hover:bg-slate-100">ğŸ›ï¸ My Orders</a>
      <a href="{{ url_for('search_medicine') }}" class="block px-3 py-2 rounded-lg hover:bg-slate-100">ğŸ” Find Medicine</a>
      <a href="{{ url_for('profile') }}" class="block px-3 py-2 rounded-lg hover:bg-slate-100">âš™ï¸ Profile Settings</a>
      <a href="{{ url_for('logout') }}" class="block px-3 py-2 rounded-lg hover:bg-slate-100">ğŸšª Logout</a>
    </nav>
  </aside>

  <!-- Main content -->
  <section class="lg:col-span-3 space-y-6">
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-2xl font-semibold">Your Appointments</h2>
        <div class="muted">Upcoming & recent consultations</div>
      </div>
      <div>
        <a href="{{ url_for('book_appointment') }}" class="btn-modern btn-success-modern">ğŸ“ Book New Appointment</a>
      </div>
    </div>

    <div class="card overflow-x-auto">
      <table class="w-full text-left">
        <thead class="text-slate-500 text-sm">
          <tr>
            <th class="py-3">#</th>
            <th>Doctor</th>
            <th>When</th>
            <th>Status</th>
            <th class="text-right">Action</th>
          </tr>
        </thead>
        <tbody class="divide-y">
          {% for a in appts %}
          <tr class="align-top">
            <td class="py-4 w-12">{{ a.id }}</td>
            <td>
              <div class="font-medium">{{ doctor_map[a.doctor_id].fullname }}</div>
              <div class="muted text-xs">{{ doctor_map[a.doctor_id].specialization }}</div>
            </td>
            <td class="py-4">{{ a.datetime }}</td>
            <td class="py-4">
              {% if a.status == 'Scheduled' %}
                <span class="px-2 py-1 rounded-full text-xs bg-indigo-50 text-indigo-700">{{ a.status }}</span>
              {% else %}
                <span class="px-2 py-1 rounded-full text-xs bg-slate-100 text-slate-700">{{ a.status }}</span>
              {% endif %}
            </td>
            <td class="py-4 text-right">
              <a class="inline-block px-3 py-1 text-sm border rounded-lg mr-2" href="{{ a.room }}" target="_blank">Join</a>
              <a class="inline-block px-3 py-1 text-sm bg-indigo-600 text-white rounded-lg" href="{{ url_for('consult', appt_id=a.id) }}">Details</a>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="5" class="py-8 text-center muted">No appointments yet. Book your first consultation.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>
</div>
{% endblock %}
