{% extends 'base.html' %}
{% block content %}
<div class="max-w-4xl mx-auto">
  <div class="card">
    <div class="flex items-start justify-between mb-6">
      <div class="flex-1">
        <div class="flex items-center gap-3 mb-2">
          <h1 class="text-3xl font-bold text-gray-900">{{ disease.name }}</h1>
          {% if disease.category %}
          <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full">{{ disease.category }}</span>
          {% endif %}
        </div>
        {% if disease.description %}
        <p class="text-gray-600 text-lg">{{ disease.description }}</p>
        {% endif %}
      </div>
      <a href="{{ url_for('health_library') }}" class="px-4 py-2 border rounded-lg hover:bg-gray-50">â† Back</a>
    </div>

    <!-- Symptoms Section -->
    <div class="mb-8 p-5 bg-red-50 border border-red-200 rounded-lg">
      <h2 class="text-xl font-semibold text-red-900 mb-3 flex items-center">
        <span class="mr-2">ğŸ©º</span> Symptoms
      </h2>
      <div class="text-gray-700 whitespace-pre-line">{{ disease.symptoms }}</div>
    </div>

    <!-- Remedies Section -->
    <div class="mb-8 p-5 bg-green-50 border border-green-200 rounded-lg">
      <h2 class="text-xl font-semibold text-green-900 mb-3 flex items-center">
        <span class="mr-2">ğŸ’Š</span> Remedies & Treatment
      </h2>
      <div class="text-gray-700 whitespace-pre-line">{{ disease.remedies }}</div>
    </div>

    <!-- Prevention Section -->
    {% if disease.prevention %}
    <div class="mb-8 p-5 bg-blue-50 border border-blue-200 rounded-lg">
      <h2 class="text-xl font-semibold text-blue-900 mb-3 flex items-center">
        <span class="mr-2">ğŸ›¡ï¸</span> Prevention
      </h2>
      <div class="text-gray-700 whitespace-pre-line">{{ disease.prevention }}</div>
    </div>
    {% endif %}

    <!-- YouTube Video Section -->
    {% if disease.youtube_link %}
    <div class="mb-8 p-5 bg-gray-50 border border-gray-200 rounded-lg">
      <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
        <span class="mr-2">ğŸ“º</span> Educational Video
        <span id="offline-badge" class="ml-2 px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded hidden">âš ï¸ Offline</span>
      </h2>
      
      <!-- Video iframe -->
      <div id="video-container" class="aspect-video rounded-lg overflow-hidden bg-gray-200 flex items-center justify-center">
        {% set video_id = disease.youtube_link.split('v=')[-1].split('&')[0] if 'watch?v=' in disease.youtube_link else disease.youtube_link.split('/')[-1] %}
        <iframe 
          id="youtube-iframe"
          width="100%" 
          height="100%" 
          src="https://www.youtube.com/embed/{{ video_id }}" 
          title="{{ disease.name }}" 
          frameborder="0" 
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
          allowfullscreen
          class="w-full h-full"
          onerror="handleVideoError()">
        </iframe>
      </div>
      
      <!-- Offline fallback message -->
      <div id="offline-message" class="hidden aspect-video rounded-lg bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-dashed border-gray-300 flex flex-col items-center justify-center p-6 text-center">
        <div class="text-6xl mb-4">ğŸ“±</div>
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Video Unavailable Offline</h3>
        <p class="text-gray-600 mb-4 max-w-md">YouTube videos require an internet connection. All disease information above is available offline!</p>
        <div class="bg-white px-4 py-2 rounded-lg shadow-sm border border-gray-200">
          <p class="text-sm text-gray-700">Video Link:</p>
          <a href="{{ disease.youtube_link }}" target="_blank" class="text-blue-600 hover:underline text-sm break-all">{{ disease.youtube_link }}</a>
          <p class="text-xs text-gray-500 mt-2">Save this link to watch later when online</p>
        </div>
      </div>
      
      <p class="text-sm text-gray-500 mt-2">
        <a href="{{ disease.youtube_link }}" target="_blank" class="text-blue-600 hover:underline" id="youtube-link">Open in YouTube â†’</a>
        <span id="offline-note" class="ml-2 text-orange-600 hidden">(Requires internet connection)</span>
      </p>
    </div>
    {% endif %}
    
    <!-- Offline Detection Script -->
    <script>
    // Check if user is online
    function updateOnlineStatus() {
      const isOnline = navigator.onLine;
      const offlineBadge = document.getElementById('offline-badge');
      const offlineMessage = document.getElementById('offline-message');
      const videoContainer = document.getElementById('video-container');
      const offlineNote = document.getElementById('offline-note');
      
      if (!isOnline) {
        // Show offline indicators
        if (offlineBadge) offlineBadge.classList.remove('hidden');
        if (offlineMessage) offlineMessage.classList.remove('hidden');
        if (videoContainer) videoContainer.classList.add('hidden');
        if (offlineNote) offlineNote.classList.remove('hidden');
      } else {
        // Hide offline indicators
        if (offlineBadge) offlineBadge.classList.add('hidden');
        if (offlineMessage) offlineMessage.classList.add('hidden');
        if (videoContainer) videoContainer.classList.remove('hidden');
        if (offlineNote) offlineNote.classList.add('hidden');
      }
    }
    
    // Check on page load
    updateOnlineStatus();
    
    // Listen for online/offline events
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    
    // Check periodically (in case events don't fire)
    setInterval(updateOnlineStatus, 5000);
    </script>

    <!-- Disclaimer -->
    <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-900">
      <strong>âš ï¸ Medical Disclaimer:</strong> This information is for educational purposes only and should not replace professional medical advice. Always consult with a qualified healthcare provider for diagnosis and treatment.
    </div>
  </div>
</div>
{% endblock %}
